<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Agentic A2A Chat</title>
    <style>
        body {
          margin: 0;
          font-family: Arial, sans-serif;
          display: flex;
          height: 100vh;
          background-color: #f5f2f7;
        }
.top-header {
  position: fixed;
  top: 0;
  left: 60px; /* leave space for sidebar */
  width: calc(100% - 60px);
  height: 50px;
  background: #e5e3f5;
  color: #333;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: bold;
  border-bottom: 1px solid #ccc;
  z-index: 100;
}

.footer {
  position: fixed;
  bottom: 0;
  left: 60px; /* leave room for sidebar */
  width: calc(100% - 60px);
  height: 40px;
  background: #e5e3f5;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 30px;
  font-size: 20px;
  border-top: 1px solid #ccc;
  z-index: 100;
}

.footer a {
  text-decoration: none;
  color: #333;
  transition: transform 0.2s ease;
}

.footer a:hover {
  transform: scale(1.2);
}

        .sidebar {
          width: 60px;
          background-color: #dcdaf0;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding-top: 10px;
        }

        .sidebar button {
          background: none;
          border: none;
          font-size: 24px;
          margin: 15px 0;
          cursor: pointer;
        }

      .content {
  flex: 1;
  padding: 20px;
  padding-top: 70px; /* make space for header */
  display: flex;
  flex-direction: column;
}


        .header {
          font-size: 20px;
          font-weight: bold;
          margin-bottom: 10px;
        }

        .chat-box {
          flex: 1;
          background: #f1edf5;
          border: 1px solid #ccc;
          padding: 10px;
          overflow-y: auto;
          margin-bottom: 10px;
        }

        .input-area {
          display: flex;
        }

        .input-area input {
          flex: 1;
          padding: 10px;
          font-size: 16px;
        }

        .input-area button {
          padding: 10px 15px;
          font-size: 16px;
          background-color: #0b64f1;
          color: white;
          border: none;
          cursor: pointer;
        }

        .hidden {
          display: none;
        }

        #agent-popup {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          border: 2px solid #0b64f1;
          padding: 20px;
          width: 300px;
          max-height: 400px;
          overflow: auto;
          box-shadow: 0 0 10px rgba(0,0,0,0.3);
          z-index: 1000;
          display: none;
          border-radius: 8px;
          resize: both;
          min-width: 250px;
          min-height: 150px;
          max-width: 90vw;
          max-height: 80vh;
        }

        #agent-popup h3 {
          margin-top: 0;
        }

        #agent-popup ul {
          padding-left: 20px;
        }

        #agent-popup button.close-btn {
          margin-top: 15px;
          background-color: #0b64f1;
          color: white;
          border: none;
          padding: 8px 12px;
          cursor: pointer;
          border-radius: 4px;
        }

        #popup-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0,0,0,0.3);
          display: none;
          z-index: 999;
        }

        #add-agent-popup {
          position: fixed;
          top: 0; left: 0;
          width: 100vw; height: 100vh;
          background: rgba(0, 0, 0, 0.4);
          display: none;
          align-items: center;
          justify-content: center;
          z-index: 1100;
        }

        .popup-content {
          background: white;
          border-radius: 10px;
          padding: 20px;
          width: 400px;
          max-width: 90%;
          box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        #add-agent-popup input {
          width: 100%;
          padding: 10px;
          font-size: 16px;
          margin-top: 10px;
        }

        .popup-content button {
          margin-right: 10px;
          padding: 8px 12px;
          font-size: 14px;
          background-color: #0b64f1;
          color: white;
          border: none;
          cursor: pointer;
          border-radius: 4px;
        }
    </style>
</head>
<body>
<header class="top-header">
    üåê Online A2A Client built with&nbsp; <span> - </span>&nbsp;
    <a href="https://github.com/vishalmysore/a2ajava" target="_blank" style="color: #0b64f1; text-decoration: none;"><strong>a2ajava</strong></a>

</header>
<div class="sidebar">
    <button onclick="showSection('conversation')">üí¨</button>
    <button onclick="addAgent()">‚ûï</button>
    <button onclick="listAgents()">üìã</button>
    <button onclick="window.open('https://www.linkedin.com/pulse/complete-ai-agent-tutorial-a2a-mcp-protocol-4-different-vishal-mysore-l1cjc/', '_blank')" title="Agent Catalog">üìö</button>
    <button onclick="window.open('https://medium.com/@visrow/what-is-agentic-mesh-how-to-build-one-66c88c926e3a', '_blank')" title="Agentic Mesh">üï∏Ô∏è</button>
    <button onclick="window.open('https://medium.com/@visrow/agentic-rag-mcp-ingestion-agent-583d0f948b6e', '_blank')" title="Agentic RAG">ü§ñ</button>
</div>

<div class="content">
    <div class="header">üß† Conversation</div>
    <div id="conversation-section">
        <div class="chat-box" id="chat-box"></div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="How can I help you?" onkeydown="handleKey(event)" />
            <button onclick="sendMessage()">‚ñ∂</button>
        </div>
    </div>
</div>

<!-- Overlays and Popups -->
<div id="popup-overlay"></div>

<div id="agent-popup">
    <h3>Agent List</h3>
    <ul id="agent-list"></ul>
    <button class="close-btn" onclick="closeAgentPopup()">Close</button>
</div>

<div id="add-agent-popup">
    <div class="popup-content">
        <h3>Add Your Agent</h3>
        <p>Please give the full path with <strong>http</strong> or <strong>https</strong>.</p>
        <p>Some Examples are here.</p>
        <ul style="padding-left: 20px; font-size: 0.9em;">
            <li>https://vishalmysore-a2amcpdemo.hf.space/</li>
            <li>https://vishalmysore-a2amcpspring.hf.space/</li>
            <li>https://vishalmysore-a2amcpmongo.hf.space/</li>
        </ul>
        <input type="text" id="agent-url-input" placeholder="Enter full agent URL..." />
        <br/><br/>
        <button onclick="submitAgentUrl()">Submit</button>
        <button onclick="closeAddAgentPopup()">Cancel</button>
    </div>
</div>

<script>
    const chatBox = document.getElementById("chat-box");
    const agentPopup = document.getElementById("agent-popup");
    const agentList = document.getElementById("agent-list");
    const popupOverlay = document.getElementById("popup-overlay");
    const addAgentPopup = document.getElementById("add-agent-popup");

    const socket = new WebSocket("ws://localhost:7860/websocket");

    socket.onopen = () => {
      appendMessage("üîå Connected to server.");
    };

    socket.onmessage = (event) => {
      if (agentPopup.style.display === "block" && event.data.startsWith("Agent: ")) {
        addAgentToList(event.data.substring(7));
        return;
      }
      appendMessage("ü§ñ " + event.data);
    };

    socket.onclose = () => {
      appendMessage("‚ùå Disconnected from server.");
    };
function addNewline() {
  const div = document.createElement("div");
  div.appendChild(document.createElement("br"));
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}
function handleKey(event) {
  if (event.key === 'Enter') {
    event.preventDefault(); // Prevent form submission or default behavior if any
    sendMessage();
  }
}
    function appendMessage(message) {
      const div = document.createElement("div");
      div.textContent = message;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById("user-input");
      const message = input.value.trim();
      if (message) {
        const payload = {
          action: "talkToAgent",
          query: message
        };
        socket.send(JSON.stringify(payload));
        addNewline();
        appendMessage("\nüì§ " + message);
        input.value = "";
      }
    }

    function addAgent() {
      addAgentPopup.style.display = "flex";
      document.getElementById("agent-url-input").value = "";
    }

    function submitAgentUrl() {
      const url = document.getElementById("agent-url-input").value.trim();
      if (url && (url.startsWith("http://") || url.startsWith("https://"))) {
        const payload = {
          action: "addAgent",
          url: url
        };
        socket.send(JSON.stringify(payload));
        appendMessage("üì° Add agent request sent: " + url);
        closeAddAgentPopup();
      } else {
        alert("Please enter a valid full URL starting with http or https.");
      }
    }

    function closeAddAgentPopup() {
      addAgentPopup.style.display = "none";
    }

    function listAgents() {
      if (socket.readyState !== WebSocket.OPEN) {
        alert("WebSocket is not connected.");
        return;
      }
      agentList.innerHTML = "";
      agentPopup.style.display = "block";
      popupOverlay.style.display = "block";
      const payload = { action: "listAgents" };
      socket.send(JSON.stringify(payload));
    }

    function addAgentToList(agentInfo) {
      const li = document.createElement("li");
      li.textContent = agentInfo;
      agentList.appendChild(li);
    }

    function closeAgentPopup() {
      agentPopup.style.display = "none";
      popupOverlay.style.display = "none";
      agentList.innerHTML = "";
    }

    function showSection(name) {
      document.getElementById("conversation-section").classList.remove("hidden");
    }
</script>
<footer class="footer">
    <a href="https://www.linkedin.com/in/vishalrow/" target="_blank" title="LinkedIn">üîó</a>
    <a href="https://medium.com/@visrow" target="_blank" title="Medium">üìñ</a>
    <a href="https://github.com/vishalmysore/a2aClient" target="_blank" title="GitHub">üíª</a>
    <a href="https://github.com/vishalmysore/a2ajava" target="_blank" title="A2A Java">üß†</a>
</footer>

</body>
</html>
